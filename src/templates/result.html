{% extends "base.html" %}

{% block title %}{{ t('result', 'title') }} - {{ super() }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- ヘッダー -->
    <div class="text-center mb-8">
        <div class="flex items-center justify-center gap-4 mb-2">
            <h1 class="text-4xl font-bold">{{ t('result', 'title') }}</h1>
            {% if fiscal_year %}
            <span class="text-xl text-base-content/60">{{ fiscal_year }}</span>
            {% endif %}
        </div>
    </div>

    <!-- 選択内容の表示（Collapse） -->
    <div class="collapse collapse-arrow bg-base-100 shadow-xl mb-6">
        <input type="checkbox" />
        <div class="collapse-title text-xl font-medium">
            {{ t('result', 'selected_conditions') }}
        </div>
        <div class="collapse-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 pt-4">
                <!-- セメスタ -->
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">{{ t('index', 'semester') }}</div>
                        <div class="stat-value text-2xl text-primary">{{ semester_name }}</div>
                    </div>
                </div>

                <!-- 第一メジャー -->
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">{{ t('index', 'major1') }}</div>
                        <div class="stat-value text-2xl text-secondary">{{ major1_name }}</div>
                    </div>
                </div>

                <!-- 第二メジャー -->
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">{{ t('index', 'major2') }}</div>
                        <div class="stat-value text-2xl text-accent">{{ major2_name }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 時間割プレースホルダー -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">{{ t('result', 'timetable') }}</h2>

            <!-- 準備中メッセージ -->
            <div class="alert alert-info">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>{{ t('result', 'generating_message') }}</span>
            </div>

            <!-- 時間割表と単位情報 -->
            <div class="flex flex-col lg:flex-row gap-4 mt-6">
                <!-- 時間割表 -->
                <div class="flex-1 overflow-x-auto">
                    <table class="table w-full">
                    <thead>
                        <tr class="bg-base-200">
                            <th class="text-center w-16">{{ t('result', 'period') }}</th>
                            <th class="text-center">{{ t('result', 'monday') }}</th>
                            <th class="text-center">{{ t('result', 'tuesday') }}</th>
                            <th class="text-center">{{ t('result', 'wednesday') }}</th>
                            <th class="text-center">{{ t('result', 'thursday') }}</th>
                            <th class="text-center">{{ t('result', 'friday') }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 1〜5限を動的に表示 -->
                        {% for period in range(1, 6) %}
                        <tr class="hover">
                            <td class="text-center font-semibold bg-base-200">{{ period }}</td>
                            <!-- 月曜〜金曜のセル -->
                            {% for day_id in range(1, 6) %}
                            <td class="p-2">
                                {% if timetable[day_id].get(period) %}
                                <div class="text-sm">
                                    <div class="font-semibold text-primary">{{ timetable[day_id][period]['course_title'] }}</div>
                                    {% if timetable[day_id][period]['instructor_name'] %}
                                    <div class="text-xs text-base-content/70">{{ timetable[day_id][period]['instructor_name'] }}</div>
                                    {% endif %}
                                </div>
                                {% else %}
                                <div class="text-center text-base-content/40">-</div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                </div>

                <!-- 単位情報 -->
                <div class="w-full lg:w-64">
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body p-4">
                            <h3 class="font-semibold text-lg mb-3">{{ t('result', 'credit_info') }}</h3>

                            <!-- 第一メジャー単位 -->
                            <div class="mb-4">
                                <div class="text-sm font-medium text-primary mb-2">{{ major1_name }}</div>
                                <div class="stats stats-vertical shadow w-full">
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'required') }}</div>
                                        <div class="stat-value text-xl">{{ major1_credits['required'] }}</div>
                                        <div class="stat-desc text-xs">{{ t('result', 'credits') }}</div>
                                    </div>
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'elective') }}</div>
                                        <div class="stat-value text-xl">{{ major1_credits['elective'] }}</div>
                                        <div class="stat-desc text-xs">{{ t('result', 'credits') }}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 第二メジャー単位 -->
                            <div class="mb-4">
                                <div class="text-sm font-medium text-secondary mb-2">{{ major2_name }}</div>
                                <div class="stats stats-vertical shadow w-full">
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'required') }}</div>
                                        <div class="stat-value text-xl">{{ major2_credits['required'] }}</div>
                                        <div class="stat-desc text-xs">{{ t('result', 'credits') }}</div>
                                    </div>
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'elective') }}</div>
                                        <div class="stat-value text-xl">{{ major2_credits['elective'] }}</div>
                                        <div class="stat-desc text-xs">{{ t('result', 'credits') }}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="divider my-2"></div>

                            <!-- 合計単位 -->
                            <div class="stats shadow w-full bg-accent/10">
                                <div class="stat py-2 px-3">
                                    <div class="stat-title text-xs font-semibold">{{ t('result', 'total') }}</div>
                                    <div class="stat-value text-2xl text-accent">{{ total_credits }}</div>
                                    <div class="stat-desc text-xs font-medium">{{ t('result', 'credits') }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- アクションボタン -->
    <div class="flex justify-center gap-4 mb-8">
        <a href="{{ url_for('index') }}" class="btn btn-outline btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            {{ t('result', 'back') }}
        </a>

        <button class="btn btn-primary" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            {{ t('result', 'download') }}
        </button>
    </div>
</div>
{% endblock %}
