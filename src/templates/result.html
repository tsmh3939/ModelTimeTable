{% extends "base.html" %}

{% block title %}{{ t('result', 'title') }} - {{ super() }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- ヘッダー -->
    <div class="text-center mb-8">
        <div class="flex items-center justify-center gap-4 mb-2">
            <h1 class="text-4xl font-bold">{{ t('result', 'title') }}</h1>
            {% if fiscal_year %}
            <span class="text-xl text-base-content/60">{{ fiscal_year }}</span>
            {% endif %}
        </div>
    </div>

    <!-- 選択内容の表示（Collapse） -->
    <div class="collapse collapse-arrow bg-base-100 shadow-xl mb-6">
        <input type="checkbox" checked />
        <div class="collapse-title text-xl font-medium">
            {{ t('result', 'selected_conditions') }}
        </div>
        <div class="collapse-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 pt-4">
                <!-- セメスタ -->
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">{{ t('index', 'semester') }}</div>
                        <div class="stat-value text-2xl text-accent">{{ semester_name }}</div>
                    </div>
                </div>

                <!-- 第一メジャー -->
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">{{ t('index', 'major1') }}</div>
                        <div class="stat-value text-2xl text-primary">{{ major1_name }}</div>
                    </div>
                </div>

                <!-- 第二メジャー -->
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">{{ t('index', 'major2') }}</div>
                        <div class="stat-value text-2xl text-secondary">{{ major2_name }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 時間割プレースホルダー -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">{{ t('result', 'timetable') }}</h2>

            <!-- 時間割表 -->
            <div class="overflow-x-auto mt-6">
                <table class="table w-full">
                <thead>
                    <tr class="bg-base-200">
                        <th class="text-center w-8 font-normal border border-base-300 px-2 py-1"></th>
                        <th class="text-center font-normal border border-base-300 px-2 py-1">{{ t('result', 'monday') }}</th>
                        <th class="text-center font-normal border border-base-300 px-2 py-1">{{ t('result', 'tuesday') }}</th>
                        <th class="text-center font-normal border border-base-300 px-2 py-1">{{ t('result', 'wednesday') }}</th>
                        <th class="text-center font-normal border border-base-300 px-2 py-1">{{ t('result', 'thursday') }}</th>
                        <th class="text-center font-normal border border-base-300 px-2 py-1">{{ t('result', 'friday') }}</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 1〜5限を動的に表示 -->
                    {% for period in range(1, 6) %}
                    <tr class="hover">
                        <td class="text-center bg-base-200 border border-base-300" style="padding: 0;">{{ period }}</td>
                        <!-- 月曜〜金曜のセル -->
                        {% for day_id in range(1, 6) %}
                        <td class="border border-base-300 px-2 py-2">
                        {% if timetable[day_id].get(period) %}
                            <div class="text-sm">
                                {% set item = timetable[day_id][period] %}
                                {% set major_type = item['major_type'] %}

                                {% set indicator = '' %}
                                {% set color_class = 'text-base-content' %}

                                {% if major_type == 'major1' %}
                                    {% set indicator = '【' + t('result', 'label_major1') + '】' %}
                                    {% set color_class = 'text-primary' %}
                                {% elif major_type == 'shared' %}
                                    {% set indicator = '【' + t('result', 'label_shared') + '】' %}
                                    {% set color_class = 'text-primary' %}
                                {% elif major_type == 'major2' %}
                                    {% set indicator = '【' + t('result', 'label_major2') + '】' %}
                                    {% set color_class = 'text-secondary' %}
                                {% elif major_type == 'others' %}
                                    {% set indicator = '【' + t('result', 'label_others') + '】' %}
                                    {% set color_class = 'text-info' %}
                                {% elif major_type == 'info_app' %}
                                    {% set indicator = '【' + t('result', 'label_info_app') + '】' %}
                                    {% set color_class = 'text-warning' %}
                                {% endif %}

                                <div class="font-semibold {{ color_class }}">
                                    {{ indicator }}<br>{{ item['course_title'] }}
                                </div>
                                {% if item['instructor_name'] %}
                                <div class="text-xs text-base-content/70">{{ item['instructor_name'] }}</div>
                                {% endif %}
                            </div>
                            {% else %}
                            <div class="text-center text-base-content/40">-</div>
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>

            <!-- 単位情報 -->
            <div class="mt-6">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body p-4">
                        <h3 class="font-semibold text-lg mb-3">{{ t('result', 'credit_info') }}</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
                            <!-- 第一メジャー単位 -->
                            <div>
                                <div class="text-sm font-medium text-primary mb-2">{{ t('result', 'major1_courses') }}</div>
                                <div class="stats stats-vertical shadow w-full">
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'required_mandatory') }}</div>
                                        <div class="stat-value text-xl">{{ major1_credits['required'] }}</div>
                                    </div>
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'elective_required_elective') }}</div>
                                        <div class="stat-value text-xl">{{ major1_credits['elective'] }}</div>
                                    </div>
                                </div>
                                <!-- 情報学領域共有科目（1単位以上の場合のみ表示） -->
                                {% if (shared_credits['required'] + shared_credits['elective']) >= 1 %}
                                <div class="text-sm font-medium text-primary mb-2 mt-4">{{ t('result', 'shared_courses') }}</div>
                                <div class="stats stats-vertical shadow w-full">
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'required_mandatory') }}</div>
                                        <div class="stat-value text-xl">{{ shared_credits['required'] }}</div>
                                    </div>
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'elective_required_elective') }}</div>
                                        <div class="stat-value text-xl">{{ shared_credits['elective'] }}</div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>

                            <!-- 第二メジャー単位 -->
                            <div>
                                <div class="text-sm font-medium text-secondary mb-2">{{ t('result', 'major2_courses') }}</div>
                                <div class="stats stats-vertical shadow w-full">
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'required_mandatory') }}</div>
                                        <div class="stat-value text-xl">{{ major2_credits['required'] }}</div>
                                    </div>
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'elective_required_elective') }}</div>
                                        <div class="stat-value text-xl">{{ major2_credits['elective'] }}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- その他メジャー単位（1単位以上の場合のみ表示） -->
                            {% if (others_credits['required'] + others_credits['elective']) >= 1 %}
                            <div>
                                <div class="text-sm font-medium text-info mb-2">{{ t('result', 'others_courses') }}</div>
                                <div class="stats stats-vertical shadow w-full">
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'required_mandatory') }}</div>
                                        <div class="stat-value text-xl">{{ others_credits['required'] }}</div>
                                    </div>
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'elective_required_elective') }}</div>
                                        <div class="stat-value text-xl">{{ others_credits['elective'] }}</div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- 情報応用科目単位（1単位以上の場合のみ表示） -->
                            {% if (info_app_credits['required'] + info_app_credits['elective']) >= 1 %}
                            <div>
                                <div class="text-sm font-medium text-warning mb-2">{{ t('result', 'info_app_courses') }}</div>
                                <div class="stats stats-vertical shadow w-full">
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'required_mandatory') }}</div>
                                        <div class="stat-value text-xl">{{ info_app_credits['required'] }}</div>
                                    </div>
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs">{{ t('result', 'elective_required_elective') }}</div>
                                        <div class="stat-value text-xl">{{ info_app_credits['elective'] }}</div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- 合計単位 -->
                            <div>
                                <div class="text-sm font-medium mb-2">&nbsp;</div>
                                <div class="stats shadow w-full bg-accent/10">
                                    <div class="stat py-2 px-3">
                                        <div class="stat-title text-xs font-semibold">{{ t('result', 'total_simple') }}</div>
                                        <div class="stat-value text-2xl text-accent">{{ total_credits }}</div>
                                        <div class="stat-desc text-xs font-medium">{{ t('result', 'credits') }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- アクションボタン -->
    <div class="flex justify-center gap-4 mb-8">
        <a href="{{ url_for('index') }}" class="btn btn-outline btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            {{ t('result', 'back') }}
        </a>

        <button class="btn btn-primary" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            {{ t('result', 'download') }}
        </button>
    </div>
</div>
{% endblock %}
